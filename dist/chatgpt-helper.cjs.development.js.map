{"version":3,"file":"chatgpt-helper.cjs.development.js","sources":["../src/index.ts"],"sourcesContent":["import split2 from 'split2';\nimport { Readable } from 'stream';\nimport { OpenAI } from 'openai';\nimport { zodToJsonSchema } from 'zod-to-json-schema';\nimport { z } from 'zod';\n\n//TODO: have a strict type\ntype AnyZodObject = any;\n\nexport function getParameterFromZod(schema: AnyZodObject) {\n  const {\n    $schema: _$schema,\n    //@ts-ignore\n    additionalProperties: _additionalProps,\n    ...jsonSchema\n  } = zodToJsonSchema(schema);\n  return jsonSchema;\n}\n\nexport function createExtractor({\n  purpose: description,\n  schema,\n}: {\n  purpose: string;\n  schema: AnyZodObject;\n}): OpenAI.Chat.Completions.ChatCompletionCreateParams.Function {\n  const parameters = getParameterFromZod(schema);\n  return {\n    name: 'metadata_extract',\n    description,\n    parameters,\n  };\n}\n\ntype ToolImplementation = (\n  a?: any\n) => Promise<Record<string, any>> | Record<string, any>;\n\ntype ToolDefenitionArgs = {\n  name: string;\n  purpose: string;\n  argSchema?: AnyZodObject;\n  implementation: ToolImplementation;\n};\n\nexport class Tools {\n  tools: OpenAI.Chat.Completions.ChatCompletionCreateParams.Function[];\n  functions: Record<string, ToolImplementation>;\n\n  constructor() {\n    this.tools = [];\n    this.functions = {};\n  }\n\n  addTool({\n    name,\n    purpose: description,\n    argSchema: schema = z.object({}),\n    implementation,\n  }: ToolDefenitionArgs) {\n    this.functions[name] = implementation;\n    const parameters = getParameterFromZod(schema);\n    this.tools.push({\n      name,\n      description,\n      parameters,\n    });\n    return this;\n  }\n}\n\ntype RunWithToolsUntilCompleteArgs = {\n  api: OpenAI;\n  prompt: string;\n  tools: Tools;\n} & Partial<\n  Exclude<\n    OpenAI.Chat.Completions.ChatCompletionCreateParamsNonStreaming,\n    'functions' | 'function_call'\n  >\n>;\n\nconst DEFAULT_MODEL = 'gpt-3.5-turbo-0613';\n\nexport async function runWithToolsUntilComplete({\n  api,\n  prompt,\n  tools,\n  model = DEFAULT_MODEL,\n  messages = [],\n  ...opts\n}: RunWithToolsUntilCompleteArgs) {\n  let complete = false;\n  messages = [...messages, { role: 'user', content: prompt }];\n  let lastMessage: OpenAI.Chat.Completions.ChatCompletionMessage | undefined =\n    undefined;\n  while (!complete) {\n    const chatCompletion = await api.chat.completions.create({\n      model,\n      messages,\n      functions: tools.tools,\n      function_call: 'auto',\n      ...opts,\n    });\n\n    const { message } = chatCompletion.choices?.[0];\n    lastMessage = message;\n    if (message) {\n      messages = [...messages, message];\n      if (message.function_call) {\n        const { name: functionName, arguments: _args = '{}' } =\n          message.function_call;\n        const functionArgument: Record<string, any> = JSON.parse(_args);\n        const functionResult = await tools.functions[functionName!](\n          functionArgument\n        );\n        messages = [\n          ...messages,\n          {\n            role: 'function',\n            name: functionName,\n            content: JSON.stringify(functionResult),\n          },\n        ];\n      } else {\n        complete = true;\n      }\n    } else {\n      throw new Error('MessageResponseEmpty');\n    }\n  }\n  return { messages, lastMessage };\n}\n\nexport async function extractDataWithPrompt({\n  api,\n  schema,\n  prompt: content,\n  metadataDescription: purpose = '',\n  ...opts\n}: {\n  api: OpenAI;\n  schema: AnyZodObject;\n  prompt: string;\n  metadataDescription?: string;\n} & Partial<\n  Omit<\n    OpenAI.Chat.Completions.ChatCompletionCreateParamsNonStreaming,\n    'messages' | 'functions' | 'function_call'\n  >\n>) {\n  const fn = createExtractor({ purpose, schema });\n  const { model = DEFAULT_MODEL, ...otherOpts } = opts;\n  const chatCompletion = await api.chat.completions.create({\n    model,\n    messages: [{ role: 'user', content }],\n    functions: [fn],\n    function_call: { name: fn.name },\n    ...otherOpts,\n  });\n  if (chatCompletion.choices?.[0]?.message?.function_call) {\n    const { message } = chatCompletion.choices?.[0];\n    return { data: message!.function_call!.arguments, message };\n  } else {\n    throw new Error('ResultEmpty');\n  }\n}\n\nexport async function extractStreamWithPrompt({\n  api,\n  schema,\n  prompt: content,\n  metadataDescription: purpose = '',\n  ...opts\n}: {\n  api: OpenAI;\n  schema: AnyZodObject;\n  prompt: string;\n  metadataDescription?: string;\n} & Partial<\n  Omit<\n    OpenAI.Chat.Completions.ChatCompletionCreateParamsStreaming,\n    'messages' | 'functions' | 'function_call'\n  >\n>) {\n  const fn = createExtractor({ purpose, schema });\n  const { model = DEFAULT_MODEL, ...otherOpts } = opts;\n  const chatCompletion = await api.chat.completions.create({\n    model,\n    messages: [{ role: 'user', content }],\n    functions: [fn],\n    function_call: { name: fn.name },\n    ...otherOpts,\n    stream: true,\n  });\n  //@ts-ignore\n  return chatCompletion.data.pipe(\n    split2((line) => {\n      if (\n        line?.trim() &&\n        !line.includes('[DONE]') &&\n        line.startsWith('data: ')\n      ) {\n        const chunkJson = line.replace('data: ', '');\n        const obj = JSON.parse(chunkJson);\n        return obj?.choices?.[0]?.delta?.function_call?.arguments || '';\n      }\n    })\n  ) as Readable;\n}\n"],"names":["getParameterFromZod","schema","_zodToJsonSchema","zodToJsonSchema","jsonSchema","_objectWithoutPropertiesLoose","_excluded","createExtractor","_ref","description","purpose","parameters","name","Tools","tools","functions","_proto","prototype","addTool","_ref2","_ref2$argSchema","argSchema","z","object","implementation","push","DEFAULT_MODEL","runWithToolsUntilComplete","_x","_runWithToolsUntilComplete","apply","arguments","_asyncToGenerator","_regeneratorRuntime","mark","_callee","_ref3","api","prompt","_ref3$model","model","_ref3$messages","messages","opts","complete","lastMessage","_chatCompletion$choic2","chatCompletion","_chatCompletion$choic","message","_message$function_cal","functionName","_message$function_cal2","_args","functionArgument","functionResult","wrap","_callee$","_context","prev","next","_excluded2","concat","role","content","undefined","chat","completions","create","_extends","function_call","sent","choices","JSON","parse","stringify","Error","abrupt","stop","extractDataWithPrompt","_x2","_extractDataWithPrompt","_callee2","_ref4","_chatCompletion$choic3","_chatCompletion$choic4","_chatCompletion$choic5","_ref4$metadataDescrip","fn","_opts$model","otherOpts","_chatCompletion$choic7","_chatCompletion$choic6","_callee2$","_context2","metadataDescription","_excluded3","_excluded5","data","extractStreamWithPrompt","_x3","_extractStreamWithPrompt","_callee3","_ref5","_ref5$metadataDescrip","_opts$model2","_callee3$","_context3","_excluded4","_excluded6","stream","pipe","split2","line","trim","includes","startsWith","_obj$choices","_obj$choices$","_obj$choices$$delta","_obj$choices$$delta$f","chunkJson","replace","obj","delta"],"mappings":"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"}